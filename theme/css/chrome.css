/* CSS for UI elements (a.k.a. chrome) */

@import "variables.css";

:target {
  scroll-margin-top: calc(var(--header-height) + 20px);
}

/* GRID */
#body-container {
  min-height: 100vh;
  display: grid;
  grid:
    [row1-start] "header header header header" auto [row1-end]
    [row2-start] "sidebar sidebar-resize menu-bar content" 1fr [row2-end]
    [row3-start] "footer footer footer footer" auto [row3-end]
    / 0 0 auto 1fr;
}

.no-js #body-container {
  display: grid;
  grid:
    [row1-start] "header header header" auto [row1-end]
    [row2-start] "sidebar sidebar-resize menu-bar content" auto [row2-end]
    [row3-start] "footer footer footer" auto [row3-end]
    / 0 0 auto 1fr;
}

#header {
  grid-area: header;
}

#sidebar {
  grid-area: sidebar;
}

#sidebar-resize-handle {
  grid-area: sidebar-resize;
}

#content {
  grid-area: content;
}

#footer {
  grid-area: footer;
}

#menu-bar {
  grid-area: menu-bar;
}

::-webkit-scrollbar {
  background: var(--bg);
}

::-webkit-scrollbar-thumb {
  background: var(--scrollbar);
}

html {
  scrollbar-color: var(--scrollbar) var(--bg);
}

.content h2 a:link {
  color: var(--links-hover);
}

#searchresults a,
a > .hljs {
  color: var(--links);
}

/*
    body-container is necessary because mobile browsers don't seem to like
    overflow-x on the body tag when there is a <meta name="viewport"> tag.
*/
#body-container {
  /*
        This is used when the sidebar pushes the body content off the side of
        the screen on small screens. Without it, dragging on mobile Safari
        will want to reposition the viewport in a weird way.
    */
  overflow-x: clip;
  transition: 200ms;
}

/* Menu Bar */

#menu-bar {
  position: relative;
  background-color: var(--bg);
}

.menu-bar-inner {
  position: sticky;
  top: var(--header-height);
  display: flex;
  align-items: flex-start;
  flex-direction: column;
}

#menu-bar i,
#menu-bar .icon-button {
  position: relative;
  padding: 0 8px;
  z-index: 10;
  line-height: var(--menu-bar-height);
  cursor: pointer;
  transition: color 0.5s;
}

@media only screen and (max-width: 420px) {
  #menu-bar i,
  #menu-bar .icon-button {
    padding: 0 5px;
  }
}

.icon-button {
  border: none;
  background: none;
  padding: 0;
  color: inherit;
}

.icon-button i {
  margin: 0;
}

.menu-title {
  display: none;
}

.menu-bar,
.menu-bar:visited,
.nav-chapters,
.nav-chapters:visited,
.menu-bar .icon-button,
.menu-bar a:link,
.menu-bar a:visited {
  color: var(--page-nav-fg);
}

.menu-bar i:hover,
.menu-bar .icon-button:hover,
.nav-chapters:hover,
.mobile-nav-chapters i:hover {
  color: var(--icons-hover);
}

.no-js #theme-toggle,
.no-js #search-toggle {
  display: none;
}

/* Nav Icons */

.nav-chapters {
  font-size: 2.5em;
  text-align: center;
  text-decoration: none;

  position: fixed;
  top: 0;
  bottom: 0;
  margin: 0;
  max-width: 150px;
  min-width: 90px;

  display: flex;
  justify-content: center;
  align-content: center;
  flex-direction: column;

  transition:
    color 0.5s,
    background-color 0.5s;
}

.nav-chapters:hover {
  text-decoration: none;
  background-color: var(--theme-hover);
  transition:
    background-color 0.15s,
    color 0.15s;
}

.nav-wrapper {
  display: block;
  margin-block-start: 50px;
}

.content .mobile-nav-chapters {
  display: block;
  font-size: 1em;
  font-weight: 700;
  text-align: center;
  text-decoration: none;
  padding: 10px 20px;
  border-radius: 9999px;
  background-color: var(--button-nav-bg);
  color: var(--button-nav-fg);
  border: 2px solid transparent;
  transition-property: border, color;
  transition-duration: 0.5s;
}

a.mobile-nav-chapters:hover {
  color: var(--button-nav-hover-fg);
  background: var(--button-nav-hover-bg);
  text-decoration: none;
  border: 2px solid var(--button-nav-hover-border);
}

a.mobile-nav-chapters:active {
  color: var(--button-nav-hover-fg);
  background: var(--button-nav-hover-bg);
  border: 2px solid var(--button-nav-hover-border);
}

/* Only Firefox supports flow-relative values */
.previous {
  float: left;
}

[dir="rtl"] .previous {
  float: right;
}

/* Only Firefox supports flow-relative values */
.next {
  float: right;
  right: var(--page-padding);
}

[dir="rtl"] .next {
  float: left;
  right: unset;
  left: var(--page-padding);
}

/* Use the correct buttons for RTL layouts*/
[dir="rtl"] .previous i.fa-angle-left:before {
  content: "\f105";
}

[dir="rtl"] .next i.fa-angle-right:before {
  content: "\f104";
}

@media only screen and (max-width: 1080px) {
  .nav-wide-wrapper {
    display: none;
  }

  .nav-wrapper {
    display: block;
  }
}

/* sidebar-visible */
@media only screen and (max-width: 1380px) {
  #sidebar-toggle-anchor:checked ~ .page-wrapper .nav-wide-wrapper {
    display: none;
  }

  #sidebar-toggle-anchor:checked ~ .page-wrapper .nav-wrapper {
    display: block;
  }
}

/* Inline code */

:not(pre) > .hljs {
  display: inline;
  padding: 0.1em 0.3em;
  border-radius: 3px;
}

:not(pre):not(a) > .hljs {
  /* color: var(--inline-code-color); */
  overflow-x: initial;
}

a:hover > .hljs {
  text-decoration: underline;
}

pre {
  position: relative;
}
pre > .buttons {
  position: absolute;
  z-index: 100;
  right: 0px;
  top: 2px;
  margin: 0px;
  padding: 2px 0px;

  color: var(--sidebar-fg);
  cursor: pointer;
  visibility: hidden;
  opacity: 0;
  transition:
    visibility 0.1s linear,
    opacity 0.1s linear;
}
pre:hover > .buttons {
  visibility: visible;
  opacity: 1;
}
pre > .buttons :hover {
  color: var(--sidebar-active);
  border-color: var(--icons-hover);
  background-color: var(--theme-hover);
}
pre > .buttons i {
  margin-inline-start: 8px;
}
pre > .buttons button {
  cursor: inherit;
  margin: 0px 5px;
  padding: 3px 5px;
  font-size: 14px;

  border-style: solid;
  border-width: 1px;
  border-radius: 4px;
  border-color: var(--icons);
  background-color: var(--theme-popup-bg);
  transition: 100ms;
  transition-property: color, border-color, background-color;
  color: var(--icons);
}

@media (pointer: coarse) {
  pre > .buttons button {
    /* On mobile, make it easier to tap buttons. */
    padding: 3px 10px;
  }

  .sidebar-resize-indicator {
    /* Hide resize indicator on devices with limited accuracy */
    display: none;
  }
}
pre > code {
  display: block;
  padding: 10px;
}

/* FIXME: ACE editors overlap their buttons because ACE does absolute
   positioning within the code block which breaks padding. The only solution I
   can think of is to move the padding to the outer pre tag (or insert a div
   wrapper), but that would require fixing a whole bunch of CSS rules.
*/
.hljs.ace_editor {
  padding: 0rem 0rem;
}

pre > .result {
  margin-block-start: 10px;
}

/* Search */

#search-wrapper {
  position: sticky;
  top: var(--header-height);
  background-color: var(--bg);
}

#searchresults a {
  text-decoration: none;
}

mark {
  border-radius: 2px;
  padding-block-start: 0;
  padding-block-end: 1px;
  padding-inline-start: 3px;
  padding-inline-end: 3px;
  margin-block-start: 0;
  margin-block-end: -1px;
  margin-inline-start: -3px;
  margin-inline-end: -3px;
  color: var(--fg);
  background-color: var(--search-mark-bg);
  transition: background-color 300ms linear;
  cursor: pointer;
}

mark.fade-out {
  background-color: rgba(0, 0, 0, 0) !important;
  cursor: auto;
}

.searchbar-outer {
  margin-inline-start: auto;
  margin-inline-end: auto;
  max-width: var(--content-max-width);
}

#searchbar {
  width: 100%;
  margin-block-start: 5px;
  margin-block-end: 0;
  margin-inline-start: auto;
  margin-inline-end: auto;
  padding: 10px 16px;
  transition: box-shadow 300ms ease-in-out;
  border: 1px solid var(--searchbar-border-color);
  border-radius: 3px;
  background-color: var(--searchbar-bg);
  color: var(--searchbar-fg);
}

#searchbar:focus,
#searchbar.active {
  box-shadow: 0 0 3px var(--searchbar-shadow-color);
}

.searchresults-header {
  font-weight: bold;
  font-size: 1em;
  padding-block-start: 18px;
  padding-block-end: 0;
  padding-inline-start: 5px;
  padding-inline-end: 0;
  color: var(--searchresults-header-fg);
}

.searchresults-outer {
  margin-inline-start: auto;
  margin-inline-end: auto;
  max-width: var(--content-max-width);
  border-block-end: 1px dashed var(--searchresults-border-color);
}

ul#searchresults {
  list-style: none;
  padding-inline-start: 20px;
}

ul#searchresults li {
  margin: 10px 0px;
  padding: 2px;
  border-radius: 2px;
}

ul#searchresults li.focus {
  background-color: var(--searchresults-li-bg);
}

ul#searchresults span.teaser {
  display: block;
  clear: both;
  margin-block-start: 5px;
  margin-block-end: 0;
  margin-inline-start: 20px;
  margin-inline-end: 0;
  font-size: 0.8em;
}

ul#searchresults span.teaser em {
  font-weight: bold;
  font-style: normal;
}

/* Sidebar */

.sidebar {
  font-size: 0.875em;
  box-sizing: border-box;
  background-color: var(--sidebar-bg);
  color: var(--sidebar-fg);
  position: relative;
}

.sidebar .sidebar-scrollbox {
  position: sticky;
  top: 80px;
  padding: 30px 0;
  max-height: 100vh;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior-y: contain;
}

.sidebar .sidebar-contents {
  padding: 10px 20px;
}

.sidebar-resizing {
  -moz-user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.sidebar code {
  line-height: 2em;
}

.sidebar-resize-handle {
  cursor: col-resize;
  display: flex;
  align-items: center;
  margin-left: var(--sidebar-resize-indicator-space);
  width: var(--sidebar-resize-indicator-width);
}

.sidebar-resize-handle .sidebar-resize-indicator {
  display: none;
  position: fixed;
  top: 50%;
  width: var(--sidebar-resize-indicator-width);
  height: 12px;
  background-color: var(--icons);
}

.sidebar::-webkit-scrollbar {
  background: var(--sidebar-bg);
}

.sidebar::-webkit-scrollbar-thumb {
  background: var(--scrollbar);
}

/* sidebar-visible */
#sidebar-toggle-anchor:checked ~ #body-container {
  /* On Mobile, max the width of the sidebar, but always leave room for the menu button */
  grid-template-columns: var(--sidebar-width-mobile) 0 auto minmax(300px, 1fr);
}

/* Desktop sidebar visible */
@media only screen and (min-width: 620px) {
  #sidebar-toggle-anchor:checked ~ #body-container {
    grid-template-columns:
      var(--sidebar-width) var(--sidebar-resize-indicator-width) auto
      minmax(300px, 1fr);
  }

  .sidebar-resize-handle .sidebar-resize-indicator {
    display: inherit;
  }
}

.chapter {
  list-style: none outside none;
  padding-inline-start: 0;
  line-height: 1;
}

.chapter ol {
  width: 100%;
}

.chapter li {
  display: flex;
  color: var(--sidebar-non-existant);
  margin-bottom: 0;
}

.chapter li :hover {
  color: var(--sidebar-active);
  cursor: pointer;
  user-select: none;
}

.chapter li a {
  display: block;
  padding: 0;
  text-decoration: none;
  color: var(--sidebar-fg);
}

.chapter li a:hover {
  color: var(--sidebar-active);
}

.chapter li a.active {
  color: var(--sidebar-active);
}

.chapter li > a.toggle {
  cursor: pointer;
  display: block;
  margin-inline-start: auto;
  padding: 0 10px;
  user-select: none;
}

/* Switch to Chevron */
.chapter li > a.toggle {
  background-color: var(--sidebar-fg);
  mask: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="chevron"><polyline points="9 18 15 12 9 6"></polyline></svg>');
  background-repeat: no-repeat;
  mask-repeat: no-repeat;
}

.chapter li:hover > a.toggle,
.chapter a.active + a.toggle {
  background-color: var(--sidebar-active);
}

.chapter li > a.toggle div {
  display: none;
}

.chapter li > a.toggle {
  transition: transform 0.5s;
}

.chapter li.expanded > a.toggle {
  transform: rotate(90deg);
}

/* End Switch to Chevron */

/* collapse the section */
.chapter li:not(.expanded) + li > ol {
  display: none;
}

.chapter li.chapter-item {
  line-height: 1.5em;
  margin-block-start: 1em;
}

.chapter li.expanded > a.toggle div {
  transform: rotate(90deg);
}

.spacer,
.chapter .spacer {
  width: 100%;
  height: 1px;
  margin: 5px 0px;
}

.chapter .spacer,
.chapter li.spacer {
  background-color: var(--sidebar-spacer);
}

@media (-moz-touch-enabled: 1), (pointer: coarse) {
  .chapter li a {
    padding: 5px 0;
  }

  .spacer {
    margin: 10px 0;
  }
}

.section {
  list-style: none outside none;
  padding-inline-start: 20px;
  line-height: 1.9em;
  margin-bottom: 0.5em;
}

/* Theme Menu Popup */

.theme-popup {
  position: absolute;
  left: 10px;
  top: 0;
  z-index: 1000;
  border-radius: 4px;
  font-size: 0.7em;
  color: var(--sidebar-fg);
  background: var(--theme-popup-bg);
  border: 1px solid var(--theme-popup-border);
  margin: 0;
  padding: 0;
  list-style: none;
  display: none;
  /* Don't let the children's background extend past the rounded corners. */
  overflow: hidden;
}

[dir="rtl"] .theme-popup {
  left: unset;
  right: 10px;
}

.theme-popup .default {
  color: var(--icons);
}

.theme-popup .theme {
  width: 100%;
  border: 0;
  margin: 0;
  padding: 2px 10px 2px 20px;
  line-height: 25px;
  white-space: nowrap;
  text-align: start;
  cursor: pointer;
  color: inherit;
  background: inherit;
  font-size: inherit;
}

.theme-popup .theme:hover {
  background-color: var(--theme-hover);
}

.theme-popup .theme:hover:first-child,
.theme-popup .theme:hover:last-child {
  border-top-left-radius: inherit;
  border-top-right-radius: inherit;
}

.theme-selected::before {
  display: inline-block;
  content: "✓";
  margin-inline-start: -14px;
  width: 14px;
}

.nav-return:hover {
  color: var(--sidebar-active);
}

/* Underline on hover animation */
.underline-on-hover {
  position: relative;
  display: block;
  cursor: pointer;
  overflow: hidden;
  padding: 2.5px 0;
}

.underline-on-hover::after {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 0.1em;
  width: 100%;
  opacity: 0;
  transition:
    opacity 300ms,
    transform 300ms;
  content: "";
  transform: translate3d(-100%, 0, 0);
}

.underline-on-hover:hover::after,
.underline-on-hover:focus::after {
  opacity: 1;
  transform: translate3d(0, 0, 0);
}
