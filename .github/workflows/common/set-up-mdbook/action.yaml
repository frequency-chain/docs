name: "Install mdBook with Plugins"
description: 'Shared action steps to install mdBook with required plugins'
runs:
  using: "composite"
  steps:
    - name: Setup mdBook ðŸ“š
      uses: peaceiris/actions-mdbook@adeb05db28a0c0004681db83893d56c0388ea9ea
      with:
        mdbook-version: 'latest'

    - name: Install mdbook-linkcheck plugin
      shell: bash
      run: |
        curl -s https://api.github.com/repos/Michael-F-Bryan/mdbook-linkcheck/releases/latest \
          | grep browser_download_url \
          | grep $(rustc -Vv | grep host | cut -d' ' -f2) \
          | cut -d : -f 2,3 \
          | tr -d \" \
          | wget -qi - -O mdbook-linkcheck.zip

        echo "Checking to make sure we have the pinned version..."
        echo "50459b7db8e85a43d653e9f0d7524234  mdbook-linkcheck.x86_64-unknown-linux-gnu.zip" | md5sum -c
        unzip mdbook-linkcheck.zip -d mdbook-linkcheck
        chmod +x mdbook-linkcheck/mdbook-linkcheck
        echo "$PWD/mdbook-linkcheck" >> $GITHUB_PATH
